#pragma once

#include <SFML/Graphics.hpp>
#include <memory>
#include "Grid.hpp"

/**
 * @class Game
 * @brief Основной класс игры, управляющий игровым процессом
 * 
 * Класс отвечает за создание окна, обработку событий, обновление состояния игры
 * и отрисовку игрового поля. Реализует основной игровой цикл.
 */
class Game {
public:
    /**
     * @brief Конструктор игры
     * 
     * Создает окно с размерами, соответствующими игровому полю,
     * инициализирует сетку гемов и начальное состояние игры.
     */
    Game();
    
    /**
     * @brief Деструктор игры
     */
    ~Game() = default;
    
    /**
     * @brief Запускает основной игровой цикл
     * 
     * Выполняет обработку событий, обновление состояния и отрисовку
     * до тех пор, пока окно не будет закрыто.
     */
    void run();

private:
    /**
     * @brief Обрабатывает события окна
     * 
     * Обрабатывает события мыши для выбора и обмена гемов,
     * а также события закрытия окна.
     */
    void processEvents();
    
    /**
     * @brief Обновляет состояние игры
     * @param deltaTime Время, прошедшее с последнего обновления в секундах
     * 
     * Обновляет анимации гемов, проверяет совпадения и
     * обрабатывает падение гемов.
     */
    void update(float deltaTime);
    
    /**
     * @brief Отрисовывает текущее состояние игры
     * 
     * Очищает окно и отрисовывает все гемы на игровом поле.
     */
    void render();
    
    /**
     * @brief Обрабатывает клик мыши
     * @param position Позиция клика в координатах сетки
     * 
     * Обрабатывает выбор гемов и их обмен, если выбраны
     * два соседних гема.
     */
    void handleMouseClick(const sf::Vector2i& position);

    sf::RenderWindow window;        ///< Окно игры
    std::unique_ptr<Grid> grid;     ///< Игровое поле
    
    bool isFirstGemSelected;        ///< Флаг выбора первого гема
    sf::Vector2i firstGemPosition;  ///< Позиция первого выбранного гема
    int score;                      ///< Счет игры
    bool running = true;            ///< Флаг работы игрового цикла
}; 